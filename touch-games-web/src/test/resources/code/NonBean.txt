/*
 * Copyright (c) 1999-2009 Touch Tecnologia e Informatica Ltda.
 * Gomes de Carvalho, 1666, 3o. Andar, Vila Olimpia, Sao Paulo, SP, Brasil.
 * Todos os direitos reservados.
 * 
 * Este software e confidencial e de propriedade da Touch Tecnologia e
 * Informatica Ltda. (Informacao Confidencial). As informacoes contidas neste
 * arquivo nao podem ser publicadas, e seu uso esta limitado de acordo com os
 * termos do contrato de licenca.
 */

package br.com.touchtec.dali.showcase.crud.search;


import static com.google.common.base.Strings.isNullOrEmpty;
import static org.apache.commons.lang.StringUtils.removeEnd;
import br.com.touchtec.dali.crud.manager.CrudManager;
import br.com.touchtec.dali.crud.search.ClauseBuilder;
import br.com.touchtec.dali.crud.search.CrudQueryBuilder;
import br.com.touchtec.dali.target.Target;


/**
 * Transforma uma string do tipo "Brasil France ..." em uma cl√°usula "(name = 'Brazil' OR name = 'France' ...)".
 */
public class MultipleNamesClauseBuilder implements ClauseBuilder {

    public void buildClause(Target target, CrudQueryBuilder builder, CrudManager manager) {
        String value = (String) target.getValue();
        if (!isNullOrEmpty(value)) {
            String[] countries = value.split(" ");
            if (countries.length == 0) {
                return;
            }

            StringBuilder sb = new StringBuilder();
            for (String country : countries) {
                sb.append("name = '" + country.trim() + "' OR ");
            }
            String clause = removeEnd(sb.toString(), " OR ");
            clause = "(" + clause + ")";
            builder.appendWhere(clause);
        }
    }

}
